-- Вставляем корневые категории (уровень 1)
INSERT INTO product_catalog (parent, name)
VALUES
    (0, 'Бытовая техника'),
    (0, 'Компьютеры и оргтехника'),
    (0, 'Электроника'),
    (0, 'Техника для дома'),
    (0, 'Кухонная техника');

-- Вставляем подкатегории (уровень 2)
INSERT INTO product_catalog (parent, name)
VALUES
    -- Для "Бытовая техника" (parent = 1)
    (1, 'Стиральные машины'),
    (1, 'Холодильники'),
    (1, 'Телевизоры'),
    (1, 'Климатическая техника'),
    (1, 'Пылесосы'),

    -- Для "Компьютеры и оргтехника" (parent = 2)
    (2, 'Ноутбуки'),
    (2, 'Моноблоки'),
    (2, 'Системные блоки'),
    (2, 'Мониторы'),
    (2, 'Принтеры и МФУ'),

    -- Для "Электроника" (parent = 3)
    (3, 'Смартфоны'),
    (3, 'Планшеты'),
    (3, 'Фотоаппараты'),
    (3, 'Аудиотехника'),
    (3, 'Игровые консоли'),

    -- Для "Техника для дома" (parent = 4)
    (4, 'Обогреватели'),
    (4, 'Увлажнители воздуха'),
    (4, 'Водонагреватели'),
    (4, 'Освещение'),
    (4, 'Умный дом'),

    -- Для "Кухонная техника" (parent = 5)
    (5, 'Микроволновые печи'),
    (5, 'Посудомоечные машины'),
    (5, 'Кухонные плиты'),
    (5, 'Вытяжки'),
    (5, 'Хлебопечки');

-- Вставляем под-подкатегории (уровень 3)
INSERT INTO product_catalog (parent, name)
VALUES
    -- Для "Холодильники" (parent = 7)
    (7, 'Однокамерные'),
    (7, 'Двухкамерные'),
    (7, 'Side-by-Side'),
    (7, 'Встраиваемые'),

    -- Для "Телевизоры" (parent = 8)
    (8, 'До 43 дюймов'),
    (8, '43-55 дюймов'),
    (8, '55-65 дюймов'),
    (8, 'Более 65 дюймов'),

    -- Для "Климатическая техника" (parent = 9)
    (9, 'Кондиционеры'),
    (9, 'Обогреватели масляные'),
    (9, 'Тепловентиляторы'),
    (9, 'Конвекторы'),

    -- Для "Пылесосы" (parent = 10)
    (10, 'Роботы-пылесосы'),
    (10, 'Моющие пылесосы'),
    (10, 'Вертикальные пылесосы'),
    (10, 'Ручные пылесосы'),

    -- Для "Ноутбуки" (parent = 11)
    (11, '13-14 дюймов'),
    (11, '15-16 дюймов'),
    (11, '17 дюймов и больше'),
    (11, 'Игровые ноутбуки'),

    -- Для "Моноблоки" (parent = 12)
    (12, '21-24 дюйма'),
    (12, '27 дюймов'),
    (12, '32 дюйма и больше'),

    -- Для "Системные блоки" (parent = 13)
    (13, 'Игровые ПК'),
    (13, 'Офисные ПК'),
    (13, 'Рабочие станции'),

    -- Для "Мониторы" (parent = 14)
    (14, '24 дюйма и меньше'),
    (14, '27 дюймов'),
    (14, '32 дюйма и больше'),
    (14, 'Игровые мониторы'),

    -- Для "Принтеры и МФУ" (parent = 15)
    (15, 'Лазерные принтеры'),
    (15, 'Струйные принтеры'),
    (15, 'МФУ 3 в 1'),
    (15, 'Фотопринтеры'),

    -- Для "Смартфоны" (parent = 16)
    (16, 'Бюджетные'),
    (16, 'Средний класс'),
    (16, 'Премиум'),
    (16, 'Складные'),

    -- Для "Планшеты" (parent = 17)
    (17, '8-9 дюймов'),
    (17, '10-11 дюймов'),
    (17, '12 дюймов и больше'),
    (17, 'Детские планшеты'),

    -- Для "Фотоаппараты" (parent = 18)
    (18, 'Зеркальные'),
    (18, 'Беззеркальные'),
    (18, 'Компактные'),
    (18, 'Экшн-камеры'),

    -- Для "Аудиотехника" (parent = 19)
    (19, 'Наушники'),
    (19, 'Колонки портативные'),
    (19, 'Колонки стационарные'),
    (19, 'Саундбары'),

    -- Для "Обогреватели" (parent = 21)
    (21, 'Масляные радиаторы'),
    (21, 'Инфракрасные обогреватели'),
    (21, 'Тепловые пушки'),
    (21, 'Тепловые завесы'),

    -- Для "Увлажнители воздуха" (parent = 22)
    (22, 'Ультразвуковые'),
    (22, 'Паровые'),
    (22, 'Мойки воздуха'),
    (22, 'Климатические комплексы'),

    -- Для "Микроволновые печи" (parent = 26)
    (26, 'Соло'),
    (26, 'С грилем'),
    (26, 'Инверторные'),
    (26, 'Встраиваемые'),

    -- Для "Посудомоечные машины" (parent = 27)
    (27, 'Узкие 45 см'),
    (27, 'Полноразмерные 60 см'),
    (27, 'Компактные'),
    (27, 'Встраиваемые');

INSERT INTO products (amount, price, name)
VALUES
    -- Холодильники однокамерные (товары 1-5)
    (15, 25990, 'Бирюса 113'),
    (12, 18990, 'Indesit SB 167'),
    (18, 22990, 'Атлант XM 4008-022'),
    (10, 17990, 'Stinol STS 167'),
    (20, 20990, 'Saratov 113'),

    -- Холодильники двухкамерные (товары 6-10)
    (8, 48990, 'LG GA-B419SLWL'),
    (10, 56990, 'Bosch KGN39VW2AR'),
    (6, 42990, 'Indesit DF 4180 W'),
    (9, 51990, 'Haier C2F636CWMJ'),
    (7, 44990, 'Beko RCNK335K00W'),

    -- Холодильники Side-by-Side (товары 11-14)
    (4, 129990, 'Samsung RS66A8101S9'),
    (3, 149990, 'LG GC-B509SLVL'),
    (5, 109990, 'Haier HRF-722NGS'),
    (2, 189990, 'Samsung RS68A8821S9'),

    -- Холодильники встраиваемые (товары 15-17)
    (6, 78990, 'Bosch KIV38X20'),
    (5, 84990, 'Siemens KI38SA60'),
    (4, 92990, 'Liebherr ICBS 3156'),

    -- Телевизоры до 43 дюймов (товары 18-22)
    (25, 21990, 'Samsung UE43CU7100U'),
    (30, 18990, 'LG 43UR78006LK'),
    (20, 15990, 'Xiaomi TV A2 43'),
    (28, 24990, 'Sony KD-43X75WL'),
    (22, 17990, 'Philips 43PUS7608'),

    -- Телевизоры 43-55 дюймов (товары 23-27)
    (15, 39990, 'Samsung UE55CU7100U'),
    (12, 45990, 'LG 55UQ75006LF'),
    (18, 34990, 'Xiaomi TV P1 55'),
    (10, 52990, 'Sony KD-55X75WL'),
    (14, 42990, 'TCL 55C745'),

    -- Телевизоры 55-65 дюймов (товары 28-32)
    (8, 69990, 'Samsung UE65CU7100U'),
    (6, 79990, 'LG 65UQ75006LF'),
    (9, 59990, 'Xiaomi TV Q2 65'),
    (5, 89990, 'Sony KD-65X75WL'),
    (7, 74990, 'Hisense 65E7KQ'),

    -- Ноутбуки 13-14 дюймов (товары 33-37)
    (12, 74990, 'ASUS Zenbook 14 OLED'),
    (10, 89990, 'Lenovo Yoga 7 14'),
    (15, 84990, 'HP Pavilion 14'),
    (8, 114990, 'Dell XPS 13'),
    (9, 68990, 'Acer Swift 3 14'),

    -- Ноутбуки 15-16 дюймов (товары 38-42)
    (18, 69990, 'ASUS VivoBook 15'),
    (14, 84990, 'Lenovo IdeaPad 5 15'),
    (16, 79990, 'HP 15-fd0000'),
    (12, 94990, 'Dell Inspiron 15'),
    (20, 64990, 'Acer Aspire 5 15'),

    -- Ноутбуки 17 дюймов и больше (товары 43-46)
    (6, 89990, 'ASUS VivoBook 17'),
    (8, 109990, 'HP 17-cn2000'),
    (5, 99990, 'Lenovo IdeaPad 5 17'),
    (7, 119990, 'Dell Inspiron 17'),

    -- Игровые ноутбуки (товары 47-51)
    (9, 129990, 'ASUS TUF Gaming F15'),
    (7, 149990, 'Lenovo Legion 5 15'),
    (6, 169990, 'MSI Katana 15'),
    (8, 189990, 'Acer Predator Helios 16'),
    (5, 159990, 'HP Victus 16'),

    -- Моноблоки 21-24 дюйма (товары 52-55)
    (10, 49990, 'Lenovo IdeaCentre AIO 3 24'),
    (8, 59990, 'HP All-in-One 24'),
    (12, 54990, 'ASUS Vivo AIO V222'),
    (9, 44990, 'Acer Aspire C24'),

    -- Моноблоки 27 дюймов (товары 56-59)
    (6, 79990, 'Apple iMac 24" M3'),
    (5, 89990, 'Lenovo Yoga AIO 7 27'),
    (7, 84990, 'HP All-in-One 27'),
    (4, 74990, 'ASUS ProArt PA279CV'),

    -- Игровые ПК (товары 60-63)
    (4, 89990, 'HP Pavilion Gaming TG01'),
    (3, 129990, 'Lenovo Legion T5 26AMR5'),
    (5, 109990, 'ASUS ROG Strix G10CE'),
    (2, 149990, 'Acer Predator Orion 3000'),

    -- Мониторы 24 дюйма и меньше (товары 64-67)
    (25, 12990, 'Samsung F24T350FHI'),
    (30, 14990, 'LG 24MP400-B'),
    (28, 11990, 'Acer Nitro VG240Y'),
    (22, 16990, 'ASUS VA24EQ'),

    -- Мониторы 27 дюймов (товары 68-71)
    (18, 22990, 'Samsung S27A600NUI'),
    (15, 24990, 'LG 27UP650-W'),
    (20, 19990, 'Acer Nitro XV272U'),
    (12, 27990, 'ASUS TUF Gaming VG27AQ'),

    -- Игровые мониторы (товары 72-75)
    (10, 34990, 'Samsung Odyssey G5 27"'),
    (8, 44990, 'LG UltraGear 27GN800-B'),
    (12, 39990, 'ASUS TUF Gaming VG27VQ'),
    (9, 29990, 'Acer Nitro XV240Y'),

    -- Смартфоны бюджетные (товары 76-80)
    (40, 14990, 'Xiaomi Redmi 12C 4/128GB'),
    (35, 12990, 'Samsung Galaxy A04s 4/64GB'),
    (45, 11990, 'Realme C30s 3/32GB'),
    (30, 16990, 'Poco C55 6/128GB'),
    (38, 13990, 'Tecno Spark Go 2024'),

    -- Смартфоны средний класс (товары 81-85)
    (25, 34990, 'Xiaomi Redmi Note 13 8/256GB'),
    (20, 39990, 'Samsung Galaxy A34 8/128GB'),
    (28, 29990, 'Realme 11 8/256GB'),
    (22, 37990, 'Nothing Phone (2a) 8/128GB'),
    (18, 32990, 'Poco X6 8/256GB'),

    -- Смартфоны премиум (товары 86-89)
    (12, 89990, 'Samsung Galaxy S23 FE 8/256GB'),
    (10, 79990, 'Google Pixel 7a 8/128GB'),
    (8, 99990, 'iPhone 13 128GB'),
    (6, 109990, 'Samsung Galaxy S24 8/256GB'),

    -- Наушники (товары 90-94)
    (35, 7990, 'Xiaomi Redmi Buds 4 Lite'),
    (30, 12990, 'Apple AirPods 2'),
    (25, 18990, 'Sony WH-CH720N'),
    (20, 29990, 'Apple AirPods Pro 2'),
    (28, 14990, 'JBL Tune 770NC'),

    -- Колонки портативные (товары 95-99)
    (40, 8990, 'JBL Go 3'),
    (35, 14990, 'Sony SRS-XB13'),
    (30, 19990, 'JBL Flip 6'),
    (25, 24990, 'Marshall Willen'),
    (20, 34990, 'Bose SoundLink Flex'),

    -- Микроволновые печи соло (товары 100-103)
    (30, 6990, 'Samsung MS23K3515AS'),
    (35, 7990, 'LG MS-2042DB'),
    (28, 8990, 'Panasonic NN-ST34HZUE'),
    (25, 6490, 'BBK 20MWC-832S/B');

INSERT INTO product_to_catalog (product_id, catalog_id)
VALUES
    -- Холодильники однокамерные (catalog_id = 31)
    (1, 31), (2, 31), (3, 31), (4, 31), (5, 31),

    -- Холодильники двухкамерные (catalog_id = 32)
    (6, 32), (7, 32), (8, 32), (9, 32), (10, 32),

    -- Холодильники Side-by-Side (catalog_id = 33)
    (11, 33), (12, 33), (13, 33), (14, 33),

    -- Холодильники встраиваемые (catalog_id = 34)
    (15, 34), (16, 34), (17, 34),

    -- Телевизоры до 43 дюймов (catalog_id = 35)
    (18, 35), (19, 35), (20, 35), (21, 35), (22, 35),

    -- Телевизоры 43-55 дюймов (catalog_id = 36)
    (23, 36), (24, 36), (25, 36), (26, 36), (27, 36),

    -- Телевизоры 55-65 дюймов (catalog_id = 37)
    (28, 37), (29, 37), (30, 37), (31, 37), (32, 37),

    -- Ноутбуки 13-14 дюймов (catalog_id = 47)
    (33, 47), (34, 47), (35, 47), (36, 47), (37, 47),

    -- Ноутбуки 15-16 дюймов (catalog_id = 48)
    (38, 48), (39, 48), (40, 48), (41, 48), (42, 48),

    -- Ноутбуки 17 дюймов и больше (catalog_id = 49)
    (43, 49), (44, 49), (45, 49), (46, 49),

    -- Игровые ноутбуки (catalog_id = 50)
    (47, 50), (48, 50), (49, 50), (50, 50), (51, 50),

    -- Моноблоки 21-24 дюйма (catalog_id = 51)
    (52, 51), (53, 51), (54, 51), (55, 51),

    -- Моноблоки 27 дюймов (catalog_id = 52)
    (56, 52), (57, 52), (58, 52), (59, 52),

    -- Игровые ПК (catalog_id = 54)
    (60, 54), (61, 54), (62, 54), (63, 54),

    -- Мониторы 24 дюйма и меньше (catalog_id = 57)
    (64, 57), (65, 57), (66, 57), (67, 57),

    -- Мониторы 27 дюймов (catalog_id = 58)
    (68, 58), (69, 58), (70, 58), (71, 58),

    -- Игровые мониторы (catalog_id = 60)
    (72, 60), (73, 60), (74, 60), (75, 60),

    -- Смартфоны бюджетные (catalog_id = 65)
    (76, 65), (77, 65), (78, 65), (79, 65), (80, 65),

    -- Смартфоны средний класс (catalog_id = 66)
    (81, 66), (82, 66), (83, 66), (84, 66), (85, 66),

    -- Смартфоны премиум (catalog_id = 67)
    (86, 67), (87, 67), (88, 67), (89, 67),

    -- Наушники (catalog_id = 77)
    (90, 77), (91, 77), (92, 77), (93, 77), (94, 77),

    -- Колонки портативные (catalog_id = 78)
    (95, 78), (96, 78), (97, 78), (98, 78), (99, 78),

    -- Микроволновые печи соло (catalog_id = 89)
    (100, 89), (101, 89), (102, 89), (103, 89);

INSERT INTO clients (name, address)
VALUES
    ('Иванов Иван Иванович', 'г. Москва, ул. Тверская, д. 15, кв. 42'),
    ('Петрова Анна Сергеевна', 'г. Санкт-Петербург, Невский пр., д. 28, кв. 17'),
    ('Сидоров Алексей Викторович', 'г. Новосибирск, ул. Ленина, д. 32, оф. 5'),
    ('Козлова Елена Дмитриевна', 'г. Екатеринбург, пр. Ленина, д. 45, кв. 89'),
    ('Николаев Дмитрий Петрович', 'г. Нижний Новгород, ул. Советская, д. 12'),
    ('Морозова Ольга Игоревна', 'г. Казань, ул. Баумана, д. 67, кв. 23'),
    ('Васильев Андрей Николаевич', 'г. Челябинск, ул. Кирова, д. 104, оф. 12'),
    ('Павлова Марина Владимировна', 'г. Омск, ул. Маркса, д. 18, кв. 56'),
    ('Федоров Сергей Александрович', 'г. Самара, ул. Куйбышева, д. 32'),
    ('Лебедева Ирина Павловна', 'г. Ростов-на-Дону, ул. Большая Садовая, д. 55, кв. 34'),
    ('Семенов Виктор Михайлович', 'г. Уфа, ул. Ленина, д. 90, оф. 7'),
    ('Кузнецова Татьяна Андреевна', 'г. Красноярск, ул. Мира, д. 123, кв. 45'),
    ('Попов Александр Игоревич', 'г. Пермь, ул. Попова, д. 25'),
    ('Соколова Наталья Викторовна', 'г. Воронеж, пр. Революции, д. 78, кв. 12'),
    ('Волков Максим Олегович', 'г. Волгоград, ул. Рабоче-Крестьянская, д. 34, оф. 3'),
	('ООО "ТехноПром"', 'г. Москва, Ленинградский пр-т, д. 80, корп. 17, офис 405'),
    ('ИП Смирнов Константин Васильевич', 'г. Санкт-Петербург, ул. Садовая, д. 54, лит. А'),
    ('АО "Сибирские технологии"', 'г. Новосибирск, ул. Кирова, д. 86, офис 1201'),
    ('ЗАО "УралСталь"', 'г. Екатеринбург, ул. Малышева, д. 145, оф. 34'),
    ('ИП Петрова Анна Сергеевна', 'г. Нижний Новгород, ул. Родионова, д. 23, кв. 67'),
    ('ООО "Татарстан Трейд"', 'г. Казань, ул. Петербургская, д. 52, офис 15'),
    ('ПАО "Челябинский завод"', 'г. Челябинск, ул. Свободы, д. 2'),
    ('ИП Ковалев Михаил Юрьевич', 'г. Омск, ул. 10 лет Октября, д. 195, кв. 89'),
    ('ООО "ВолгаСтрой"', 'г. Самара, ул. Ново-Садовая, д. 106, оф. 305'),
    ('ЗАО "Донской фермер"', 'г. Ростов-на-Дону, ул. Социалистическая, д. 74'),
    ('ИП Галимова Лилия Рашидовна', 'г. Уфа, ул. Революционная, д. 45, кв. 28'),
    ('ООО "ЕнисейЛес"', 'г. Красноярск, ул. 9 Мая, д. 77, офис 42'),
    ('АО "Пермские моторы"', 'г. Пермь, ул. Луначарского, д. 72, оф. 510'),
    ('ИП Соколов Владимир Николаевич', 'г. Воронеж, ул. Плехановская, д. 39, кв. 15'),
    ('ООО "ВолгоградАгро"', 'г. Волгоград, ул. Комсомольская, д. 12, оф. 7');

INSERT INTO orders (client_id, dt)
VALUES
    (1, NOW() - (random() * interval '90 days') - interval '1 day'),
    (1, NOW() - (random() * interval '90 days') - interval '1 day'),
    (1, NOW() - (random() * interval '90 days') - interval '1 day'),
    (2, NOW() - (random() * interval '90 days') - interval '1 day'),
    (2, NOW() - (random() * interval '90 days') - interval '1 day'),
    (3, NOW() - (random() * interval '90 days') - interval '1 day'),
    (3, NOW() - (random() * interval '90 days') - interval '1 day'),
    (3, NOW() - (random() * interval '90 days') - interval '1 day'),
    (4, NOW() - (random() * interval '90 days') - interval '1 day'),
    (5, NOW() - (random() * interval '90 days') - interval '1 day'),
    (5, NOW() - (random() * interval '90 days') - interval '1 day'),
    (6, NOW() - (random() * interval '90 days') - interval '1 day'),
    (7, NOW() - (random() * interval '90 days') - interval '1 day'),
    (7, NOW() - (random() * interval '90 days') - interval '1 day'),
    (9, NOW() - (random() * interval '90 days') - interval '1 day'),
    (11, NOW() - (random() * interval '90 days') - interval '1 day'),
    (11, NOW() - (random() * interval '90 days') - interval '1 day'),
    (11, NOW() - (random() * interval '90 days') - interval '1 day'),
    (12, NOW() - (random() * interval '90 days') - interval '1 day'),
    (13, NOW() - (random() * interval '90 days') - interval '1 day'),
    (15, NOW() - (random() * interval '90 days') - interval '1 day'),
    (16, NOW() - (random() * interval '90 days') - interval '1 day'),
    (16, NOW() - (random() * interval '90 days') - interval '1 day'),
    (18, NOW() - (random() * interval '90 days') - interval '1 day'),
    (20, NOW() - (random() * interval '90 days') - interval '1 day'),
    (20, NOW() - (random() * interval '90 days') - interval '1 day'),
    (22, NOW() - (random() * interval '90 days') - interval '1 day'),
    (24, NOW() - (random() * interval '90 days') - interval '1 day'),
    (26, NOW() - (random() * interval '90 days') - interval '1 day'),
    (26, NOW() - (random() * interval '90 days') - interval '1 day'),
    (29, NOW() - (random() * interval '90 days') - interval '1 day');

INSERT INTO order_items (order_id, item, count)
VALUES
    (1, 1, 2),
    (1, 76, 1),
    (1, 90, 3),
    (2, 18, 1),
    (2, 33, 1),
    (3, 47, 1),
    (3, 72, 1),
    (3, 95, 2),
    (4, 23, 1),
    (4, 86, 1),
    (5, 100, 1),
    (5, 6, 1),
    (6, 11, 1),
    (6, 28, 1),
    (6, 47, 1),
    (6, 72, 1),
    (6, 86, 2),
    (7, 76, 3),
    (7, 90, 5),
    (8, 33, 1),
    (8, 64, 2),
    (9, 81, 1),
    (9, 91, 1),
    (10, 1, 1),
    (10, 100, 1),
    (11, 18, 1),
    (11, 76, 2),
    (12, 47, 1),
    (12, 72, 1),
    (12, 86, 1),
    (13, 15, 1),
    (13, 28, 1),
    (14, 33, 2),
    (14, 64, 3),
    (15, 90, 8),
    (16, 1, 5),
    (16, 18, 3),
    (16, 76, 10),
    (17, 33, 2),
    (17, 64, 4),
    (18, 90, 15),
    (18, 95, 10),
    (19, 86, 1),
    (19, 91, 1),
    (20, 6, 1),
    (20, 23, 1),
    (21, 47, 1),
    (21, 72, 1),
    (22, 33, 3),
    (22, 64, 5),
    (22, 90, 7),
    (23, 86, 5),
    (24, 1, 2),
    (24, 100, 3),
    (25, 76, 20),
    (25, 90, 25),
    (26, 33, 5),
    (26, 86, 8),
    (27, 1, 10),
    (27, 18, 8),
    (28, 33, 4),
    (28, 64, 6),
    (29, 47, 2),
    (29, 72, 2),
    (30, 86, 3),
    (30, 91, 3),
    (31, 1, 4),
    (31, 100, 4);

CREATE OR REPLACE VIEW top_5_products_last_month AS
SELECT
    p.name AS product_name,
    cat_l1.name AS main_category,
    SUM(oi.count) AS total_sold_units
FROM orders o
    INNER JOIN order_items oi ON o.id = oi.order_id
    INNER JOIN products p ON oi.item = p.id
    INNER JOIN product_to_catalog ptc ON p.id = ptc.product_id
    INNER JOIN product_catalog cat_l3 ON ptc.catalog_id = cat_l3.id
    INNER JOIN product_catalog cat_l2 ON cat_l3.parent = cat_l2.id
    INNER JOIN product_catalog cat_l1 ON cat_l2.parent = cat_l1.id
WHERE o.dt >= NOW() - INTERVAL '1 month'
GROUP BY p.id, p.name, cat_l1.name
ORDER BY total_sold_units DESC
LIMIT 5;